<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>kds</title>
  <!-- MDB icon -->
  <link rel="icon" href="img/mdb-favicon.ico" type="image/x-icon">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
  <!-- Google Fonts Roboto -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
  <!-- Material Design Bootstrap -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/mdb.min.css') }}">
  <!-- Your custom styles (optional) -->
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

  <!-- Start your project here-->  

<!-- Editable table -->

<div class="card">
  <h3 class="card-header text-center font-weight-bold text-uppercase py-4">Editable table</h3>
  <div class="card-body">
    <div id="table" class="table-editable">
      <span class="table-add float-right mb-3 mr-2"><a href="#!" class="text-success"><i
            class="fas fa-plus fa-2x" aria-hidden="true"></i></a></span>
      <table class="table table-bordered table-responsive-md table-striped text-center">
        <thead>
          <tr>
            <th class="text-center">id</th>
            <th class="text-center">Name</th>
            <th class="text-center">PLZ</th>
            <th class="text-center">Ort</th>
            <th class="text-center">_</th>
          </tr>
        </thead>
        <tbody>
          {% for field in data %}
          <tr>
            <td class="pt-3-half" contenteditable="false">{{ field.id }}</td>
            <td class="pt-3-half" contenteditable="true">{{ field.name }}</td>
            <td class="pt-3-half" contenteditable="true">{{ field.zipcode }}</td>
            <td class="pt-3-half" contenteditable="true">{{ field.location }}</td>
            <td>
              <span class="table-remove"><button type="button"
                  class="btn btn-danger btn-rounded btn-sm my-0">Remove</button></span>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
<!-- Editable table -->

  <!-- End your project here-->

  <!-- jQuery -->
  <script type="text/javascript" src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
  <!-- Bootstrap tooltips -->
  <script type="text/javascript" src="{{ url_for('static', filename='js/popper.min.js') }}"></script>
  <!-- Bootstrap core JavaScript -->
  <script type="text/javascript" src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
  <!-- MDB core JavaScript -->
  <script type="text/javascript" src="{{ url_for('static', filename='js/mdb.min.js') }}"></script>
  <!-- Your custom scripts (optional) -->
  <script type="text/javascript"></script>

  <script type="text/javascript">
    const $tableID = $('#table');
    const $BTN = $('#export-btn');
    const $EXPORT = $('#export');
    
    const newTr = `
    <tr class="hide">
      <td class="pt-3-half" contenteditable="true">Example</td>
      <td class="pt-3-half" contenteditable="true">Example</td>
      <td class="pt-3-half" contenteditable="true">Example</td>
      <td class="pt-3-half" contenteditable="true">Example</td>
      <td>
        <span class="table-remove"><button type="button" class="btn btn-danger btn-rounded btn-sm my-0 waves-effect waves-light">Remove</button></span>
      </td>
    </tr>`;
    
    $('.table-add').on('click', 'i', () => {
    
       const $clone = $tableID.find('tbody tr').last().clone(true).removeClass('hide table-line');
    
       if ($tableID.find('tbody tr').length === 0) {
    
         $('tbody').append(newTr);
       }
    
       $tableID.find('table').append($clone);
     });
    
     $tableID.on('click', '.table-remove', function () {
    
       $(this).parents('tr').detach();
     });
    
     $tableID.on('click', '.table-up', function () {
    
       const $row = $(this).parents('tr');
    
       if ($row.index() === 0) {
         return;
       }
    
       $row.prev().before($row.get(0));
     });
    
     $tableID.on('click', '.table-down', function () {
    
       const $row = $(this).parents('tr');
       $row.next().after($row.get(0));
     });
    
     // A few jQuery helpers for exporting only
     jQuery.fn.pop = [].pop;
     jQuery.fn.shift = [].shift;
    
     $BTN.on('click', () => {
    
       const $rows = $tableID.find('tr:not(:hidden)');
       const headers = [];
       const data = [];
    
       // Get the headers (add special header logic here)
       $($rows.shift()).find('th:not(:empty)').each(function () {
    
         headers.push($(this).text().toLowerCase());
       });
    
       // Turn all existing rows into a loopable array
       $rows.each(function () {
         const $td = $(this).find('td');
         const h = {};
    
         // Use the headers from earlier to name our hash keys
         headers.forEach((header, i) => {
    
           h[header] = $td.eq(i).text();
         });
    
         data.push(h);
       });
    
       // Output the result
       $EXPORT.text(JSON.stringify(data));
     });
    </script>
    
</body>
</html>
